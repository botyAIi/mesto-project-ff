(()=>{"use strict";const e=document.querySelector("#card-template").content;function t(t,o,n,r,c,a,s){const l=e.querySelector(".card").cloneNode(!0),u=l.querySelector(".card__image"),i=l.querySelector(".card__delete-button"),p=l.querySelector(".card__like-score"),d=l.querySelector(".card__title"),_=l.querySelector(".card__like-button");return t.owner._id!==n._id&&i.remove(),t.likes.find((e=>e._id===n._id))&&_.classList.add("card__like-button_is-active"),u.src=t.link,u.alt=t.name,d.textContent=t.name,p.textContent=t.likes.length,u.addEventListener("click",(()=>o(t))),_.addEventListener("click",(()=>r(c,a,t,_,p))),i.addEventListener("click",(()=>s(t,l))),l}function o(e,t,o,n,r){n.classList.contains("card__like-button_is-active")?t(o._id).then((e=>{n.classList.remove("card__like-button_is-active"),r.textContent=e.likes.length})).catch((e=>console.log(e))):e(o._id).then((e=>{n.classList.add("card__like-button_is-active"),r.textContent=e.likes.length})).catch((e=>console.log(e)))}function n(e){"Escape"===e.key&&c(document.querySelector(".popup_is-opened"))}function r(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n)}function c(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}function a(e){(e.target.classList.contains("popup_is-opened")||e.target.classList.contains("popup__close"))&&c(e.currentTarget)}function s(e,t,o){const n=e.querySelector(`.${t.id}-error`);t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""}function l(e,t){e.classList.add(t.inactiveButtonClass),e.disabled=!0}function u(e,t,o){!function(e){return e.some((e=>!e.validity.valid))}(e)?function(e,t){e.classList.remove(t.inactiveButtonClass),e.disabled=!1}(t,o):l(t,o)}function i(e,t){const o=e.querySelectorAll(t.inputSelector),n=e.querySelector(t.submitButtonSelector);o.forEach((o=>{s(e,o,t)})),l(n,t)}const p={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-7",headers:{authorization:"097edd3f-4856-47ea-8cdc-0f0b7a45c344","Content-Type":"application/json"},searchImages:/(png|jpeg)$/};function d(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}const _=e=>fetch(`${p.baseUrl}/cards/likes/${e}`,{method:"PUT",headers:p.headers}).then((e=>d(e))),m=e=>fetch(`${p.baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:p.headers}).then((e=>d(e))),y={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_is-disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};let h={};const f=document.querySelector(".places__list"),v=document.querySelector(".profile__title"),S=document.querySelector(".profile__description"),b=document.querySelector(".profile__image"),q=document.querySelectorAll(".popup"),g=document.querySelector(".popup_type_edit"),C=document.querySelector(".popup_type_update-avatar"),E=document.querySelector(".popup_type_new-card"),L=document.querySelector(".popup_type_image"),k=document.querySelector(".popup_type_card-delete"),$=k.querySelector(".popup__button"),x=E.querySelector(".popup__button"),T=C.querySelector(".popup__button"),U=g.querySelector(".popup__button"),A=L.querySelector(".popup__image"),D=L.querySelector(".popup__caption"),P=k.querySelector(".popup__form"),j=g.querySelector(".popup__form"),w=C.querySelector(".popup__form"),B=j.querySelector(".popup__input_type_name"),N=j.querySelector(".popup__input_type_description"),O=C.querySelector(".popup__input_type_url"),H=E.querySelector(".popup__form"),I=H.querySelector(".popup__input_type_card-name"),J=H.querySelector(".popup__input_type_url"),M=document.querySelector(".profile__edit-button"),V=document.querySelector(".profile__add-button");let z="";function F(e){A.src=e.link,A.alt=e.name,D.textContent=e.name,r(L)}function G(e,t){h.id=e._id,h.element=t,r(k)}function K(e,t){e?t.textContent="Сохранение...":e||(t.textContent="Сохранить")}function Q(e,t){e?t.textContent="Удаляется...":e||(t.textContent="Да")}var R;Promise.all([fetch(`${p.baseUrl}/cards`,{headers:p.headers}).then((e=>d(e))),fetch(`${p.baseUrl}/users/me`,{headers:p.headers}).then((e=>d(e)))]).then((e=>{let[n,r]=e;n.forEach((e=>{f.append(t(e,F,r,o,_,m,G))})),H.addEventListener("submit",(e=>{var n,a;e.preventDefault(),K(!0,x),(n=I.value,a=J.value,fetch(`${p.baseUrl}/cards`,{method:"POST",headers:p.headers,body:JSON.stringify({name:`${n}`,link:`${a}`})}).then((e=>d(e)))).then((e=>{f.prepend(t(e,F,r,o,_,m,G)),H.reset(),i(H,y),c(E)})).catch((e=>console.log(e))).finally((()=>{K(!1,x)}))})),v.textContent=r.name,S.textContent=r.about,b.style.backgroundImage=`url(${r.avatar})`})).catch((e=>console.log(e))),q.forEach((e=>e.addEventListener("mousedown",a))),j.addEventListener("submit",(function(e){var t,o;e.preventDefault(),K(!0,U),(t=B.value,o=N.value,fetch(`${p.baseUrl}/users/me`,{method:"PATCH",headers:p.headers,body:JSON.stringify({name:t,about:o})}).then((e=>d(e)))).then((e=>{v.textContent=e.name,S.textContent=e.about,c(g)})).catch((e=>console.log(e))).finally((()=>{K(!1,U)}))})),w.addEventListener("submit",(function(e){var t;e.preventDefault(),K(!0,T),(t=O.value,fetch(`${t}`,{method:"HEAD",headers:{"Content-Type":"image/jpeg","Content-Type":"image/png"}}).then((e=>e.ok?e.blob():Promise.reject(`Ошибка: ${e.status}`)))).then((()=>{z=O.value})).then((()=>{(e=>fetch(`${p.baseUrl}/users/me/avatar`,{method:"PATCH",headers:p.headers,body:JSON.stringify({avatar:`${e}`})}).then((e=>d(e))))(z).then((e=>{b.style.backgroundImage=`url(${e.avatar})`,i(w,y),c(C)})).catch((e=>console.log(e))).finally((()=>{K(!1,T)}))})).catch((e=>{console.log(e)}))})),P.addEventListener("submit",(function(e){var t;e.preventDefault(),Q(!0,$),(t=h.id,fetch(`${p.baseUrl}/cards/${t}`,{method:"DELETE",headers:p.headers}).then((e=>d(e)))).then((()=>{h.element.remove(),c(k)})).catch((e=>console.log(e))).finally((()=>{Q(!1,$)}))})),M.addEventListener("click",(function(){B.value=v.textContent,N.value=S.textContent,i(j,y),r(g)})),V.addEventListener("click",(()=>r(E))),b.addEventListener("click",(()=>r(C))),R=y,Array.from(document.querySelectorAll(R.formSelector)).forEach((e=>{!function(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);u(o,n,t),o.forEach((r=>{r.addEventListener("input",(()=>{!function(e,t,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.customError):t.setCustomValidity(""),t.validity.valid?s(e,t,o):function(e,t,o){const n=e.querySelector(`.${t.id}-error`);t.classList.add(o.inputErrorClass),n.textContent=t.validationMessage,n.classList.add(o.errorClass)}(e,t,o)}(e,r,t),u(o,n,t)}))}))}(e,R)}))})();