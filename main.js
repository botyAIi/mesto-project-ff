(()=>{"use strict";const e=document.querySelector("#card-template").content;function t(t,o,r,n,c,a,s){const u=e.querySelector(".card").cloneNode(!0),l=u.querySelector(".card__image"),i=u.querySelector(".card__delete-button"),d=u.querySelector(".card__like-score"),p=u.querySelector(".card__title"),_=u.querySelector(".card__like-button");return t.owner._id!==r._id&&i.remove(),t.likes.find((e=>e._id===r._id))&&_.classList.add("card__like-button_is-active"),l.src=t.link,l.alt=t.name,p.textContent=t.name,d.textContent=t.likes.length,l.addEventListener("click",(()=>o(t))),_.addEventListener("click",(()=>n(c,a,t,_,d))),i.addEventListener("click",(()=>s(t,u))),u}function o(e,t,o,r,n){r.classList.contains("card__like-button_is-active")?t(o._id).then((e=>{r.classList.remove("card__like-button_is-active"),n.textContent=e.likes.length})).catch((e=>console.log(e))):e(o._id).then((e=>{r.classList.add("card__like-button_is-active"),n.textContent=e.likes.length})).catch((e=>console.log(e)))}function r(e){"Escape"===e.key&&c(document.querySelector(".popup_is-opened"))}function n(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",r)}function c(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",r)}function a(e){(e.target.classList.contains("popup_is-opened")||e.target.classList.contains("popup__close"))&&c(e.currentTarget)}function s(e,t,o){const r=e.querySelector(`.${t.id}-error`);t.classList.remove(o.inputErrorClass),r.classList.remove(o.errorClass),r.textContent=""}function u(e,t){e.classList.add(t.inactiveButtonClass),e.disabled=!0}function l(e,t,o){!function(e){return e.some((e=>!e.validity.valid))}(e)?function(e,t){e.classList.remove(t.inactiveButtonClass),e.disabled=!1}(t,o):u(t,o)}function i(e,t){const o=e.querySelectorAll(t.inputSelector),r=e.querySelector(t.submitButtonSelector);o.forEach((o=>{s(e,o,t)})),u(r,t)}const d={baseUrl:"https://mesto.nomoreparties.co/v1/wff-cohort-7",headers:{authorization:"097edd3f-4856-47ea-8cdc-0f0b7a45c344","Content-Type":"application/json"}};function p(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}const _=e=>fetch(`${d.baseUrl}/cards/likes/${e}`,{method:"PUT",headers:d.headers}).then((e=>p(e))),m=e=>fetch(`${d.baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:d.headers}).then((e=>p(e))),y={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_is-disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};let f={};const h=document.querySelector(".places__list"),v=document.querySelector(".profile__title"),S=document.querySelector(".profile__description"),b=document.querySelector(".profile__image"),q=document.querySelectorAll(".popup"),C=document.querySelector(".popup_type_edit"),E=document.querySelector(".popup_type_update-avatar"),L=document.querySelector(".popup_type_new-card"),k=document.querySelector(".popup_type_image"),g=document.querySelector(".popup_type_card-delete"),$=g.querySelector(".popup__button"),x=L.querySelector(".popup__button"),U=E.querySelector(".popup__button"),A=C.querySelector(".popup__button"),T=k.querySelector(".popup__image"),w=k.querySelector(".popup__caption"),B=g.querySelector(".popup__form"),D=C.querySelector(".popup__form"),P=E.querySelector(".popup__form"),N=D.querySelector(".popup__input_type_name"),O=D.querySelector(".popup__input_type_description"),j=E.querySelector(".popup__input_type_url"),J=L.querySelector(".popup__form"),H=J.querySelector(".popup__input_type_card-name"),I=J.querySelector(".popup__input_type_url"),M=document.querySelector(".profile__edit-button"),V=document.querySelector(".profile__add-button");function z(e){T.src=e.link,T.alt=e.name,w.textContent=e.name,n(k)}function F(e,t){f.id=e._id,f.element=t,n(g)}function G(e,t){e?t.textContent="Сохранение...":e||(t.textContent="Сохранить")}function K(e,t){e?t.textContent="Удаляется...":e||(t.textContent="Да")}var Q;Promise.all([fetch(`${d.baseUrl}/cards`,{headers:d.headers}).then((e=>p(e))),fetch(`${d.baseUrl}/users/me`,{headers:d.headers}).then((e=>p(e)))]).then((e=>{let[r,n]=e;r.forEach((e=>{h.append(t(e,z,n,o,_,m,F))})),J.addEventListener("submit",(e=>{var r,a;e.preventDefault(),G(!0,x),(r=H.value,a=I.value,fetch(`${d.baseUrl}/cards`,{method:"POST",headers:d.headers,body:JSON.stringify({name:`${r}`,link:`${a}`})}).then((e=>p(e)))).then((e=>{h.prepend(t(e,z,n,o,_,m,F)),J.reset(),i(J,y),c(L)})).catch((e=>console.log(e))).finally((()=>{G(!1,x)}))})),v.textContent=n.name,S.textContent=n.about,b.style.backgroundImage=`url(${n.avatar})`})).catch((e=>console.log(e))),q.forEach((e=>e.addEventListener("mousedown",a))),D.addEventListener("submit",(function(e){var t,o;e.preventDefault(),G(!0,A),(t=N.value,o=O.value,fetch(`${d.baseUrl}/users/me`,{method:"PATCH",headers:d.headers,body:JSON.stringify({name:t,about:o})}).then((e=>p(e)))).then((e=>{v.textContent=e.name,S.textContent=e.about,c(C)})).catch((e=>console.log(e))).finally((()=>{G(!1,A)}))})),P.addEventListener("submit",(function(e){e.preventDefault(),G(!0,U),(e=>fetch(`${d.baseUrl}/users/me/avatar`,{method:"PATCH",headers:d.headers,body:JSON.stringify({avatar:`${e}`})}).then((e=>p(e))))(j.value).then((e=>{b.style.backgroundImage=`url(${e.avatar})`,i(P,y),c(E)})).catch((e=>console.log(e))).finally((()=>{G(!1,U)}))})),B.addEventListener("submit",(function(e){var t;e.preventDefault(),K(!0,$),(t=f.id,fetch(`${d.baseUrl}/cards/${t}`,{method:"DELETE",headers:d.headers}).then((e=>p(e)))).then((()=>{f.element.remove(),c(g)})).catch((e=>console.log(e))).finally((()=>{K(!1,$)}))})),M.addEventListener("click",(function(){N.value=v.textContent,O.value=S.textContent,i(D,y),n(C)})),V.addEventListener("click",(()=>n(L))),b.addEventListener("click",(()=>n(E))),Q=y,Array.from(document.querySelectorAll(Q.formSelector)).forEach((e=>{!function(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);l(o,r,t),o.forEach((n=>{n.addEventListener("input",(()=>{!function(e,t,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.customError):t.setCustomValidity(""),t.validity.valid?s(e,t,o):function(e,t,o){const r=e.querySelector(`.${t.id}-error`);t.classList.add(o.inputErrorClass),r.textContent=t.validationMessage,r.classList.add(o.errorClass)}(e,t,o)}(e,n,t),l(o,r,t)}))}))}(e,Q)}))})();